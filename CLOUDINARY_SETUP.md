# إعداد Cloudinary لحل مشكلة اختفاء الصور

## المشكلة
عند إعادة نشر التطبيق على Railway، يتم حذف جميع الصور المرفوعة لأن Railway يستخدم نظام ملفات مؤقت.

## الحل: استخدام Cloudinary

### الخطوة 1: إنشاء حساب Cloudinary
1. اذهب إلى [cloudinary.com](https://cloudinary.com)
2. أنشئ حساب مجاني
3. احصل على بيانات الاعتماد:
   - Cloud Name
   - API Key
   - API Secret

### الخطوة 2: إعداد متغيرات البيئة في Railway
في لوحة تحكم Railway، أضف المتغيرات التالية:

```
CLOUDINARY_URL=cloudinary://599629738223467:Ow4bBIt20vRFBBUk1IbKLguQC98@dfbfb5r7q
CLOUDINARY_CLOUD_NAME=dfbfb5r7q
CLOUDINARY_API_KEY=599629738223467
CLOUDINARY_API_SECRET=Ow4bBIt20vRFBBUk1IbKLguQC98
```

### الخطوة 3: اختبار الإعداد
بعد إضافة المتغيرات، يمكنك اختبار Cloudinary عبر:
```
GET https://web-production-78766.up.railway.app/test-cloudinary
```

### الخطوة 4: الصور الموجودة
الصور الموجودة حالياً ستظل تعمل حتى يتم رفعها مرة أخرى.

## التحسينات المضافة

### 1. معالجة الأخطاء المحسنة
- ✅ معالجة أخطاء Cloudinary
- ✅ حذف الملفات المحلية في حالة الخطأ
- ✅ سجلات مفصلة للعمليات

### 2. تنظيف تلقائي للملفات
- ✅ حذف الملفات المحلية القديمة تلقائياً
- ✅ تنظيف كل ساعة
- ✅ حذف الملفات الأقدم من يوم واحد

### 3. تحسين إعدادات multer
- ✅ أسماء ملفات فريدة
- ✅ فحص نوع الملف
- ✅ حدود حجم الملف

### 4. تحسين CORS للصور
- ✅ كاش طويل المدى للصور
- ✅ معالجة preflight requests
- ✅ headers محسنة

## ملاحظات مهمة
- Cloudinary يوفر 25GB مجاناً شهرياً
- الصور تُحفظ في مجلد `tabibiq-profiles`
- يتم تحسين الصور تلقائياً (400x400 بكسل)
- إذا فشل Cloudinary، سيتم استخدام التخزين المحلي كبديل
- الملفات المحلية تُحذف تلقائياً بعد يوم واحد

## اختبار الحل
1. ارفع صورة جديدة
2. تحقق من أنها تُحفظ في Cloudinary
3. أعد نشر التطبيق
4. تحقق من أن الصورة لا تزال موجودة 